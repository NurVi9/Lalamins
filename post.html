<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Anime Player — Luminox</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <style>
    .player-container { position: relative; padding-top: 56.25%; }
    .player-inner { position: absolute; top:0; left:0; right:0; bottom:0; }
    .episode-card { transition: transform .18s ease, box-shadow .18s ease; position: relative; }
    .episode-card:hover { transform: translateY(-4px); box-shadow: 0 4px 15px rgba(0,0,0,0.12); }
    .watched-badge {
      position: absolute; top: 6px; right: 6px;
      background: #10b981; color: white; font-size: 10px;
      padding: 2px 6px; border-radius: 9999px;
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen">

  <!-- Header -->
  <header class="sticky top-0 z-40 bg-blue-400 shadow-sm">
    <div class="max-w-6xl mx-auto px-4 flex justify-between items-center h-16">
      <a href="index.html" class="flex items-center gap-3">
        <img src="https://www.dropbox.com/scl/fi/yz8831kakxyc5f3t5f0dl/f8968f32c554ba5cd6bcab519fc0fae8.jpg?rlkey=398wt14ned3ugz41gjz3yx9en&st=9i095v5o&dl=1" class="w-10 h-10 rounded-full border border-gray-300" alt="logo">
        <span class="font-bold text-lg text-gray-900">Luminox</span>
      </a>
    </div>
  </header>

  <!-- Main -->
  <main class="max-w-6xl mx-auto px-4 py-6 space-y-6">
    
    <!-- Tombol Back -->
    <a href="index.html" class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-gray-200 text-gray-800 shadow hover:bg-gray-300 transition">
      ⬅
    </a>

    <!-- Player -->
    <div class="bg-white rounded-lg shadow p-4">
      <h2 class="text-xl font-semibold mb-3 text-gray-900">Judul Anime</h2>
      <div class="player-container rounded-lg overflow-hidden bg-black">
        <div class="player-inner">
          <video id="videoPlayer" class="w-full h-full" controls playsinline>
            <source src="" type="video/mp4">
          </video>
          <iframe id="ytPlayer" class="w-full h-full" src="" frameborder="0" allowfullscreen style="display:none;"></iframe>
        </div>
      </div>
      <div class="mt-2 flex justify-end">
        <button id="fullscreen-btn" class="px-3 py-1 bg-gray-200 rounded text-gray-900 hover:bg-gray-300 transition">⛶ Fullscreen</button>
      </div>
    </div>

    <!-- Episode List -->
    <div class="bg-white rounded-lg shadow p-4">
      <h3 class="text-lg font-semibold mb-3 text-gray-900">Daftar Episode</h3>
      <div class="grid grid-cols-2 sm:grid-cols-3 gap-3" id="episodeList"></div>
    </div>
  </main>

  <!-- Script -->
  <script>
  const STORAGE_KEY = 'lastEpisode';
  const WATCHED_KEY = 'watchedEpisodes';
  const videoEl = document.getElementById('videoPlayer');
  const ytEl = document.getElementById('ytPlayer');

  const episodes = [
    { ep: 1, title: "Episode 1", src: "https://www.dropbox.com/scl/fi/zfrgmvypsu5vr0mc644h4/3.mp4?dl=0" },
    { ep: 2, title: "Episode 2", src: "https://www.youtube.com/watch?v=dQw4w9WgXcQ" },
    { ep: 3, title: "Episode 3", src: "https://drive.google.com/file/d/1A2B3C4D5E6F7G8H9/view?usp=sharing" }
  ];

  function detectTypeAndSrc(url) {
    if (url.includes('youtube.com/watch') || url.includes('youtu.be')) {
      let videoId = '';
      if (url.includes('youtu.be')) {
        videoId = url.split('youtu.be/')[1].split('?')[0];
      } else {
        videoId = new URL(url).searchParams.get('v');
      }
      return { type: 'youtube', src: videoId };
    }
    if (url.includes('drive.google.com')) {
      let match = url.match(/\/d\/(.+?)\//);
      if (match) {
        return { type: 'mp4', src: `https://drive.google.com/uc?export=download&id=${match[1]}` };
      }
    }
    if (url.includes('dropbox.com')) {
      return { type: 'mp4', src: url.replace('dl=0', 'dl=1') };
    }
    if (url.endsWith('.mp4')) {
      return { type: 'mp4', src: url };
    }
    return { type: 'unknown', src: url };
  }

  function loadMedia(src, type) {
    if (type === 'youtube') {
      videoEl.pause(); videoEl.style.display = 'none';
      ytEl.style.display = 'block';
      ytEl.src = `https://www.youtube.com/embed/${src}?autoplay=1`;
    } else {
      ytEl.src = ''; ytEl.style.display = 'none';
      videoEl.style.display = 'block';
      videoEl.querySelector('source').src = src;
      videoEl.load();
      videoEl.play().catch(()=>{});
    }
  }

  function setActiveEpisode(epNum) {
    document.querySelectorAll('.episode-card').forEach(ep => ep.classList.remove('ring-2','ring-blue-500'));
    const btn = document.querySelector(`.episode-card[data-ep="${epNum}"]`);
    if (btn) btn.classList.add('ring-2','ring-blue-500');
    localStorage.setItem(STORAGE_KEY, epNum);
  }

  function markWatched(epNum) {
    let watched = JSON.parse(localStorage.getItem(WATCHED_KEY)) || [];
    if (!watched.includes(epNum)) watched.push(epNum);
    localStorage.setItem(WATCHED_KEY, JSON.stringify(watched));
    updateWatchedUI();
  }

  function updateWatchedUI() {
    let watched = JSON.parse(localStorage.getItem(WATCHED_KEY)) || [];
    document.querySelectorAll('.episode-card').forEach(btn => {
      btn.querySelector('.watched-badge')?.remove();
      if (watched.includes(parseInt(btn.dataset.ep))) {
        let badge = document.createElement('span');
        badge.className = 'watched-badge';
        badge.textContent = '✔ Selesai';
        btn.appendChild(badge);
      }
    });
  }

  function initEpisodes(data) {
    const list = document.getElementById('episodeList');
    list.innerHTML = '';
    data.forEach(ep => {
      const detected = detectTypeAndSrc(ep.src);
      const btn = document.createElement('button');
      btn.className = 'episode-card p-3 rounded-md bg-gray-50 hover:bg-gray-100 text-gray-900';
      btn.dataset.type = detected.type;
      btn.dataset.src = detected.src;
      btn.dataset.ep = ep.ep;
      btn.textContent = ep.title;
      btn.addEventListener('click', () => {
        loadMedia(detected.src, detected.type);
        setActiveEpisode(ep.ep);
      });
      list.appendChild(btn);
    });
    updateWatchedUI();

    let lastEp = localStorage.getItem(STORAGE_KEY) || data[0].ep;
    let current = data.find(e => e.ep == lastEp) || data[0];
    let currentDetected = detectTypeAndSrc(current.src);
    loadMedia(currentDetected.src, currentDetected.type);
    setActiveEpisode(current.ep);

    videoEl.addEventListener('ended', () => {
      markWatched(current.ep);
      let next = data.find(e => e.ep == parseInt(current.ep) + 1);
      if (next) {
        let nextDetected = detectTypeAndSrc(next.src);
        loadMedia(nextDetected.src, nextDetected.type);
        setActiveEpisode(next.ep);
        current = next;
      }
    });
  }

  initEpisodes(episodes);

  // Tombol fullscreen + auto landscape
  const fullscreenBtn = document.getElementById('fullscreen-btn');
  fullscreenBtn.addEventListener('click', async () => {
    let target = (videoEl.style.display === 'block') ? videoEl : ytEl;

    if (target.requestFullscreen) {
      await target.requestFullscreen();
    } else if (target.webkitRequestFullscreen) {
      target.webkitRequestFullscreen();
    } else if (target.msRequestFullscreen) {
      target.msRequestFullscreen();
    }

    if (screen.orientation && screen.orientation.lock) {
      try {
        await screen.orientation.lock('landscape');
      } catch (err) {
        console.warn('Gagal mengubah orientasi:', err);
      }
    }
  });
  </script>
</body>
</html>
