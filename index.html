<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Luminox â€” DLC Game</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    /* CSS Anda tidak perlu diubah, biarkan seperti aslinya */
    :root {
      --bg: #f8f9fa; --card: #ffffff; --sidebar-bg: #ffffff; --text: #212529; --muted: #6c757d; --accent: #007bff; --accent-dark: #0056b3; --danger: #e74c3c; --ring: rgba(0, 123, 255, 0.25); --header-bg: rgba(255, 255, 255, 0.85); --border: #dee2e6; --shadow: 0 4px 6px -1px rgba(0,0,0,0.07), 0 2px 4px -2px rgba(0,0,0,0.07); --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -4px rgba(0,0,0,0.1);
    }
    [data-theme="dark"] {
      --bg: #121212; --card: #1e1e1e; --sidebar-bg: #1e1e1e; --text: #e0e0e0; --muted: #9e9e9e; --accent: #64b5f6; --accent-dark: #2196f3; --header-bg: rgba(30, 30, 30, 0.85); --border: #424242; --ring: rgba(100, 181, 246, 0.3);
    }
    *, *::before, *::after { box-sizing: border-box; }
    html { -webkit-tap-highlight-color: transparent; scroll-behavior: smooth; }
    body { background: var(--bg); color: var(--text); font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; margin: 0; transition: background .3s, color .3s; }
    .hidden { display: none !important; }
    .app-layout { display: flex; transition: margin-left .3s ease; }
    .sidebar { width: 260px; background: var(--sidebar-bg); border-right: 1px solid var(--border); position: fixed; top: 0; left: -260px; bottom: 0; z-index: 1200; display: flex; flex-direction: column; transition: left .3s ease; box-shadow: var(--shadow); }
    .sidebar.open { left: 0; }
    .content-wrapper { flex: 1; display: flex; flex-direction: column; min-height: 100vh; padding-bottom: 80px; }
    main { padding: 1rem; flex: 1; }
    .page-title { font-size: 2rem; font-weight: 700; margin-bottom: 1.5rem; letter-spacing: -0.5px; }
    .backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 1100; opacity: 0; pointer-events: none; transition: opacity .3s ease; }
    .backdrop.active { opacity: 1; pointer-events: auto; }
    .app-header { background: var(--header-bg); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 1000; padding: 0.75rem 1rem; display: flex; align-items: center; justify-content: space-between; gap: 1rem; }
    .header-left, .header-right { display: flex; align-items: center; gap: .5rem; transition: opacity 0.3s ease; }
    .header-search-container { flex: 1; display: flex; justify-content: flex-end; }
    #header-search-input { width: 0; padding: 0; border: none; background: transparent; outline: none; font-size: 1rem; color: var(--text); transition: all 0.4s ease-in-out; }
    .app-header.search-active #header-search-input { width: 100%; padding: 0.5rem; border-bottom: 2px solid var(--accent); }
    .app-header.search-active .header-left, .app-header.search-active .header-right .header-icon-btn:not(#search-toggle) { opacity: 0; pointer-events: none; }
    #search-toggle .fa-times { display: none; }
    .app-header.search-active #search-toggle .fa-search { display: none; }
    .app-header.search-active #search-toggle .fa-times { display: block; }
    .header-icon-btn { width: 40px; height: 40px; display: grid; place-items: center; border-radius: 50%; background: transparent; color: var(--muted); font-size: 1.1rem; cursor: pointer; border: none; transition: all .2s; }
    .header-icon-btn:hover { background: var(--border); color: var(--text); }
    .sidebar-header { padding: 1.5rem 1rem; border-bottom: 1px solid var(--border); }
    .sidebar-logo { display: flex; align-items: center; gap: .75rem; text-decoration: none; color: var(--text); }
    .sidebar-logo img { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; box-shadow: var(--shadow); }
    .sidebar-logo-text h2 { font-size: 1.25rem; font-weight: 600; line-height: 1.2; margin: 0; }
    .sidebar-logo-text p { font-size: .85rem; color: var(--muted); line-height: 1.2; margin: 0; }
    .sidebar-menu { flex: 1; padding: 1rem; overflow-y: auto; }
    .menu-heading { font-size: .7rem; font-weight: 700; color: var(--muted); text-transform: uppercase; letter-spacing: .8px; padding: 0 .75rem; margin: 1.5rem 0 .75rem; }
    .menu-item { display: flex; align-items: center; gap: .85rem; padding: .75rem; border-radius: 8px; font-weight: 500; text-decoration: none; color: var(--text); transition: background .2s, color .2s; cursor: pointer; }
    .menu-item i { width: 20px; text-align: center; color: var(--muted); transition: color .2s; font-size: 0.95rem; }
    .menu-item:hover { background: var(--border); }
    .menu-item.active { background: var(--accent); color: white; font-weight: 600; }
    .menu-item.active i { color: white; }
    .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; height: 65px; background: var(--header-bg); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border-top: 1px solid var(--border); display: flex; justify-content: space-around; z-index: 1000; box-shadow: 0 -5px 20px rgba(0,0,0,0.05); }
    .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--muted); flex: 1; padding: 0.5rem 0; cursor: pointer; transition: color 0.2s ease, transform 0.1s ease; }
    .nav-item:active { transform: scale(0.92); }
    .nav-item i { font-size: 1.3rem; margin-bottom: 2px; }
    .nav-item .nav-text { font-size: 0.75rem; font-weight: 500; }
    .nav-item.active { color: var(--accent); }
    #post-grid { display: grid; gap: 1rem; }
    .post-card { background: var(--card); border-radius: 16px; overflow: hidden; box-shadow: var(--shadow); transition: transform .25s ease, box-shadow .25s ease; cursor: pointer; position: relative; }
    .post-card-img-wrapper { position: relative; }
    .post-card-img { width: 100%; height: 200px; object-fit: cover; display: block; }
    .post-card-content { padding: 1.25rem; }
    .post-card-category { background: var(--accent); color: white; padding: 5px 12px; border-radius: 99px; font-weight: 600; font-size: 11px; display: inline-block; margin-bottom: 0.75rem; }
    .post-card-title { font-size: 1.2rem; font-weight: 600; margin-bottom: 0.25rem; }
    .post-card-desc { color: var(--muted); font-size: 0.95rem; line-height: 1.5; }
    .wishlist-btn { position: absolute; top: 0.75rem; right: 0.75rem; width: 40px; height: 40px; border-radius: 50%; background-color: rgba(0,0,0,0.4); color: white; border: none; cursor: pointer; display: grid; place-items: center; font-size: 1.1rem; transition: transform 0.2s ease, color 0.2s ease; }
    .wishlist-btn:hover { transform: scale(1.1); }
    .wishlist-btn.wishlisted { color: var(--danger); }
    .wishlist-btn .fa-solid { display: none; }
    .wishlist-btn.wishlisted .fa-regular { display: none; }
    .wishlist-btn.wishlisted .fa-solid { display: inline-block; animation: heartbeat 0.5s ease; }
    @keyframes heartbeat { 0% {transform: scale(1);} 50% {transform: scale(1.3);} 100% {transform: scale(1);} }
    .skeleton-card { background: var(--card); border-radius: 16px; overflow: hidden; box-shadow: var(--shadow); }
    .skeleton-img { height: 200px; background: var(--border); }
    .skeleton-content { padding: 1.25rem; }
    .skeleton-line { height: 1em; border-radius: 4px; background: var(--border); margin-bottom: .75rem; }
    .shimmer { position: relative; overflow: hidden; }
    .shimmer::after { content: ''; position: absolute; top: 0; left: -150%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent); animation: shimmer 1.5s infinite; }
    [data-theme="dark"] .shimmer::after { background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent); }
    @keyframes shimmer { 100% { left: 150%; } }
    #post-modal-wrapper, #auth-modal-wrapper { position: fixed; inset: 0; z-index: 1300; opacity: 0; pointer-events: none; transition: opacity .3s ease; }
    #post-modal-wrapper.open, #auth-modal-wrapper.open { opacity: 1; pointer-events: auto; }
    .modal-backdrop { position: absolute; inset: 0; background: rgba(0,0,0,0.4); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); }
    .modal-container { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; padding: 1rem; }
    .modal-content { background: var(--card); width: 100%; max-width: 480px; border-radius: 16px; box-shadow: var(--shadow-lg); overflow: hidden; transform: scale(0.95); transition: transform .3s ease; }
    #post-modal-wrapper.open .modal-content, #auth-modal-wrapper.open .modal-content { transform: scale(1); }
    #post-modal-header { position: relative; }
    #post-modal-img { width: 100%; height: 220px; object-fit: cover; display: block; }
    #post-modal-close { position: absolute; top: 0.75rem; right: 0.75rem; background: rgba(0,0,0,0.4); color: white; z-index: 10; }
    #post-modal-close:hover { background: rgba(0,0,0,0.6); }
    .post-details { padding: 1.5rem; }
    #modal-category { background: var(--accent); color: white; padding: 5px 12px; border-radius: 99px; font-weight: 600; font-size: 11px; display: inline-block; margin-bottom: 0.75rem; }
    #modal-title { font-size: 1.5rem; font-weight: 700; margin: 0 0 0.5rem; }
    #modal-desc { color: var(--muted); font-size: 0.95rem; line-height: 1.6; margin: 0 0 1.5rem; }
    .download-section h4 { margin: 0 0 1rem; font-size: 0.9rem; font-weight: 600; color: var(--muted); text-transform: uppercase; letter-spacing: .5px; }
    .download-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; }
    .btn-download { display: flex; align-items: center; justify-content: center; text-decoration: none; padding: 0.75rem; border-radius: 8px; font-weight: 600; transition: all .2s ease; }
    .btn-download i { margin-right: 0.5rem; font-size: 1.1rem; }
    .btn-mediafire { background-color: #0099e5; color: white; }
    .btn-mediafire:hover { background-color: #0077b2; transform: translateY(-2px); }
    .btn-gofile { background-color: #215ff3; color: white; }
    .btn-gofile:hover { background-color: #1a4ccc; transform: translateY(-2px); }
    #auth-container h2 { margin-top: 0; }
    #auth-container input, #auth-container textarea, #auth-container select { width: 100%; padding: 0.75rem; margin-bottom: 1rem; border-radius: 8px; border: 1px solid var(--border); background: var(--bg); color: var(--text); font-size: 1rem; }
    #auth-container button { width: 100%; padding: 0.75rem; border-radius: 8px; border: none; background: var(--accent); color: white; font-weight: 600; cursor: pointer; transition: background .2s; }
    #auth-container button:hover { background: var(--accent-dark); }
    #auth-container #logout-btn { background-color: var(--danger); margin-top: 1rem; }
    
    @media (min-width: 768px) {
      body { overflow: hidden; }
      .app-layout { margin-left: 260px; }
      .sidebar { left: 0; box-shadow: none; }
      .content-wrapper { padding-bottom: 0; }
      main { padding: 2rem; }
      .bottom-nav, #menu-toggle, .backdrop { display: none; }
      #post-grid { grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem; }
    }
    @media (hover: hover) { .post-card:hover { transform: translateY(-5px) scale(1.02); box-shadow: var(--shadow-lg); } }
  </style>
</head>
<body>

  <div class="app-layout">
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <a href="#" class="sidebar-logo">
          <img src="https://www.dropbox.com/scl/fi/yz8831kakxyc5f3t5f0dl/f8968f32c554ba5cd6bcab519fc0fae8.jpg?rlkey=398wt14ned3ugz41gjz3yx9en&st=6cfbpj8t&dl=1" alt="logo">
          <div class="sidebar-logo-text"><h2>Luminox</h2><p>Galeri Minecraft</p></div>
        </a>
      </div>
      <nav class="sidebar-menu">
        <p class="menu-heading">Menu</p>
        <div class="menu-item active" data-category=""><i class="fas fa-home"></i> Semua Postingan</div>
        <div class="menu-item" data-category="featured"><i class="fas fa-star"></i> Pilihan Editor</div>
        <div class="menu-item" data-category="wishlist"><i class="fas fa-heart"></i> Wishlist</div>
        <div class="menu-item" data-category="history"><i class="fas fa-history"></i> Riwayat Unduhan</div>
        
        <p class="menu-heading">Kategori</p>
        <div class="menu-item" data-category="addon"><i class="fas fa-puzzle-piece"></i> Addon</div>
        <div class="menu-item" data-category="template"><i class="fas fa-paint-brush"></i> Template</div>
        <div class="menu-item" data-category="event"><i class="fas fa-calendar-alt"></i> Event</div>
        
        <p class="menu-heading">Akun</p>
        <div class="menu-item" id="auth-menu-btn"><i class="fas fa-user-circle"></i><span id="auth-menu-text">Login</span></div>
      </nav>
    </aside>

    <div class="content-wrapper">
      <header class="app-header" id="app-header">
        <div class="header-left">
            <button id="menu-toggle" class="header-icon-btn"><i class="fas fa-bars"></i></button>
        </div>
        <div class="header-search-container">
            <input type="search" id="header-search-input" placeholder="Cari postingan..." autocomplete="off">
        </div>
        <div class="header-right">
            <button id="search-toggle" class="header-icon-btn">
                <i class="fas fa-search"></i>
                <i class="fas fa-times"></i>
            </button>
            <button id="theme-toggle" class="header-icon-btn"><i class="fas fa-moon"></i></button>
        </div>
      </header>
      <main>
        <h1 class="page-title" id="page-title">Postingan Terbaru</h1>
        
        <section id="post-grid"></section>
        <section id="skeleton-grid" class="hidden"></section>
      </main>
    </div>
  </div>

  <div class="backdrop" id="backdrop"></div>

  <nav class="bottom-nav">
    <div class="nav-item active" data-category=""><i class="fas fa-home"></i><span class="nav-text">Home</span></div>
    <div class="nav-item" data-category="featured"><i class="fas fa-star"></i><span class="nav-text">Pilihan</span></div>
    <div class="nav-item" data-category="wishlist"><i class="fas fa-heart"></i><span class="nav-text">Wishlist</span></div>
    <div class="nav-item" id="auth-bottom-nav-btn"><i class="fas fa-user-circle"></i><span class="nav-text">Akun</span></div>
  </nav>

  <div id="post-modal-wrapper">
    <div class="modal-backdrop"></div>
    <div id="post-modal" class="modal-container">
        <div class="modal-content">
            <header id="post-modal-header">
                <img id="post-modal-img" src="" alt="Detail Gambar Postingan">
                <button id="post-modal-close" class="header-icon-btn close-modal"><i class="fas fa-times"></i></button>
            </header>
            <div class="post-details">
                <div id="modal-category"></div>
                <h3 id="modal-title"></h3>
                <p id="modal-desc"></p>
                <div class="download-section">
                    <h4>Unduh File</h4>
                    <div class="download-buttons">
                        <a href="#" id="mediafire-link" target="_blank" class="btn-download btn-mediafire">
                            <i class="fa-solid fa-cloud-arrow-down"></i> MediaFire
                        </a>
                        <a href="#" id="gofile-link" target="_blank" class="btn-download btn-gofile">
                            <i class="fa-solid fa-rocket"></i> Gofile
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
  </div>

  <div id="auth-modal-wrapper">
    <div class="modal-backdrop" id="auth-modal-backdrop"></div>
    <div class="modal-container">
      <div class="modal-content" style="max-width: 420px; position: relative;">
        <button id="auth-modal-close" class="header-icon-btn" style="position:absolute; top:0.5rem; right:0.5rem; z-index:10;"><i class="fas fa-times"></i></button>
        <div id="auth-container" style="padding: 1.5rem;">
          </div>
      </div>
    </div>
  </div>


<script>
    document.addEventListener('DOMContentLoaded', () => {
      const $ = (s) => document.querySelector(s);
      const $$ = (s) => document.querySelectorAll(s);

      // --- 2. INISIALISASI SUPABASE ---
      const SUPABASE_URL = 'https://zmhshfqpyekrcddsqhuz.supabase.co';
      const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InptaHNoZnFweWVrcmNkZHNxaHV6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAxMzgxNDAsImV4cCI6MjA3NTcxNDE0MH0.I_AMK5MYj4Ett8fFnAEq-w8HHSqL9NYKnfuaTZOy4O8';
      
      const { createClient } = window.supabase;
      const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      // --- Manager & State (Tidak berubah) ---
      const createStorageManager = (key) => ({ get: () => JSON.parse(localStorage.getItem(key)) || [], save: (data) => localStorage.setItem(key, JSON.stringify(data)), });
      const WishlistManager = { ...createStorageManager('luminox_wishlist'), add: (postId) => { const wishlist = WishlistManager.get(); if (!wishlist.includes(postId)) { wishlist.push(postId); WishlistManager.save(wishlist); } }, remove: (postId) => { let wishlist = WishlistManager.get(); wishlist = wishlist.filter(id => id !== postId); WishlistManager.save(wishlist); }, has: (postId) => WishlistManager.get().includes(postId) };
      const HistoryManager = { ...createStorageManager('luminox_history'), add: (postId) => { let history = HistoryManager.get(); history = history.filter(id => id !== postId); history.unshift(postId); if (history.length > 50) history.pop(); HistoryManager.save(history); } };
      let state = { posts: [], currentCategory: '', searchQuery: '', isLoading: true, };

      // --- Logika untuk Modal Autentikasi ---
      const authModalWrapper = $('#auth-modal-wrapper');
      const authContainer = $('#auth-container');
      const openAuthModal = () => authModalWrapper.classList.add('open');
      const closeAuthModal = () => authModalWrapper.classList.remove('open');

      $('#auth-menu-btn').addEventListener('click', openAuthModal);
      $('#auth-bottom-nav-btn').addEventListener('click', openAuthModal);
      $('#auth-modal-close').addEventListener('click', closeAuthModal);
      $('#auth-modal-backdrop').addEventListener('click', closeAuthModal);

      // --- Render Functions (Tidak berubah) ---
      const showLoading = (loading) => {
        state.isLoading = loading;
        $('#skeleton-grid').classList.toggle('hidden', !loading);
        $('#post-grid').classList.toggle('hidden', loading);
      };
      const createPostElement = (post) => {
        const el = document.createElement('div');
        el.className = 'post-card';
        el.dataset.postId = post.id;
        const isWishlisted = WishlistManager.has(post.id);
        el.innerHTML = `<div class="post-card-img-wrapper"><img src="${post.img}" alt="${post.title}" class="post-card-img"><button class="wishlist-btn ${isWishlisted ? 'wishlisted' : ''}"><i class="fa-regular fa-heart"></i> <i class="fa-solid fa-heart"></i></button></div><div class="post-card-content"><div class="post-card-category">${post.category}</div><h3 class="post-card-title">${post.title}</h3><p class="post-card-desc">${post.description.substring(0, 80)}...</p></div>`;
        el.addEventListener('click', (e) => !e.target.closest('.wishlist-btn') && openPostModal(post));
        el.querySelector('.wishlist-btn').addEventListener('click', (e) => {
            e.stopPropagation();
            const btn = e.currentTarget;
            btn.classList.contains('wishlisted') ? WishlistManager.remove(post.id) : WishlistManager.add(post.id);
            btn.classList.toggle('wishlisted');
            if (['wishlist', 'history'].includes(state.currentCategory)) renderPosts();
        });
        return el;
      };
      const renderPosts = () => {
        showLoading(true);
        setTimeout(() => {
          const grid = $('#post-grid');
          grid.innerHTML = '';
          let filteredPosts = [];
          if (state.currentCategory === 'wishlist') {
              const ids = WishlistManager.get();
              filteredPosts = state.posts.filter(p => ids.includes(p.id));
          } else if (state.currentCategory === 'history') {
              const ids = HistoryManager.get();
              filteredPosts = ids.map(id => state.posts.find(p => p.id === id)).filter(Boolean);
          } else if (state.currentCategory === 'featured') {
              filteredPosts = state.posts.filter(p => p.isFeatured);
          } else {
              filteredPosts = state.posts.filter(post => {
                const query = state.searchQuery.toLowerCase();
                const matchesSearch = post.title.toLowerCase().includes(query) || post.description.toLowerCase().includes(query);
                const matchesCategory = !state.currentCategory || post.category.toLowerCase() === state.currentCategory;
                return matchesSearch && matchesCategory;
              });
          }
          if (filteredPosts.length === 0) {
            const messages = { wishlist: 'Wishlist Anda kosong.', history: 'Riwayat unduhan kosong.', featured: 'Tidak ada pilihan editor saat ini.' };
            grid.innerHTML = `<p style="color: var(--muted); text-align: center; grid-column: 1 / -1;">${messages[state.currentCategory] || 'Tidak ada postingan yang cocok.'}</p>`;
          } else {
            filteredPosts.forEach(post => grid.appendChild(createPostElement(post)));
          }
          const titles = { '': 'Postingan Terbaru', wishlist: 'Wishlist Saya', history: 'Riwayat Unduhan', featured: 'Pilihan Editor', addon: 'Addons', template: 'Templates', event: 'Events' };
          $('#page-title').textContent = state.searchQuery ? `Hasil untuk "${state.searchQuery}"` : (titles[state.currentCategory] || 'Postingan');
          showLoading(false);
        }, 300);
      };
      const postModalWrapper = $('#post-modal-wrapper');
      const openPostModal = (post) => {
        $('#post-modal-img').src = post.img;
        $('#modal-category').textContent = post.category;
        $('#modal-title').textContent = post.title;
        $('#modal-desc').textContent = post.description;
        $('#mediafire-link').href = post.links.mediafire;
        $('#gofile-link').href = post.links.gofile;
        const downloadHandler = () => HistoryManager.add(post.id);
        $$('.btn-download').forEach(btn => {
            btn.removeEventListener('click', downloadHandler);
            btn.addEventListener('click', downloadHandler, { once: true });
        });
        postModalWrapper.classList.add('open');
      };
      postModalWrapper.querySelector('.modal-backdrop').addEventListener('click', () => postModalWrapper.classList.remove('open'));
      postModalWrapper.querySelector('.close-modal').addEventListener('click', () => postModalWrapper.classList.remove('open'));
      
      // --- UI Interactivity (Tidak berubah) ---
      $('#theme-toggle').onclick = () => {
        const newTheme = document.documentElement.dataset.theme === 'dark' ? '' : 'dark';
        document.documentElement.dataset.theme = newTheme;
        $('#theme-toggle i').className = newTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        localStorage.setItem('luminox_theme', newTheme);
      };
      $('#menu-toggle').onclick = () => $('#sidebar').classList.add('open') & $('#backdrop').classList.add('active');
      $('#backdrop').onclick = () => $('#sidebar').classList.remove('open') & $('#backdrop').classList.remove('active');
      const handleCategoryClick = (e) => {
          state.currentCategory = e.currentTarget.dataset.category;
          state.searchQuery = '';
          $('#header-search-input').value = '';
          $('#app-header').classList.remove('search-active');
          $$('[data-category]').forEach(i => i.classList.remove('active'));
          $$(`[data-category="${state.currentCategory}"]`).forEach(i => i.classList.add('active'));
          renderPosts();
          if(window.innerWidth < 768) {
            $('#sidebar').classList.remove('open');
            $('#backdrop').classList.remove('active');
          }
      };
      $$('[data-category]').forEach(item => item.addEventListener('click', handleCategoryClick));
      $('#search-toggle').onclick = () => {
        const header = $('#app-header');
        header.classList.toggle('search-active');
        if (header.classList.contains('search-active')) $('#header-search-input').focus();
        else { state.searchQuery = ''; renderPosts(); }
      };
      $('#header-search-input').addEventListener('input', (e) => { state.searchQuery = e.target.value; renderPosts(); });
      
      
      // --- BAGIAN AUTENTIKASI (HANYA LOGIN) ---
      async function getUserRole() {
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) return null;
        const { data: profile, error } = await supabase.from('profiles').select('role').eq('id', user.id).single();
        return error ? null : profile.role;
      }

      async function setupAdminUI() {
        const role = await getUserRole();
        
        if (role === 'admin' || role === 'moderator') {
          // Tampilkan form upload jika role sesuai
          authContainer.innerHTML = `<h2>Buat Postingan Baru</h2><form id="upload-form"><label for="title">Judul:</label><input type="text" id="title" name="title" required><label for="description">Deskripsi:</label><textarea id="description" name="description" rows="4" required></textarea><label for="category">Kategori:</label><select id="category" name="category" required><option value="Template">Template</option><option value="Addon">Addon</option><option value="Event">Event</option></select><label for="img">URL Gambar:</label><input type="text" id="img" name="img" required><label for="mediafire">Link MediaFire:</label><input type="url" id="mediafire" name="mediafire" required><label for="gofile">Link Gofile:</label><input type="url" id="gofile" name="gofile" required><input type="checkbox" id="isFeatured" name="isFeatured" style="width: auto; margin-bottom: 1rem;"><label for="isFeatured">Jadikan Pilihan Editor?</label><br><button type="submit">Upload Postingan</button></form><button id="logout-btn">Logout</button>`;
          authContainer.querySelector('#upload-form').addEventListener('submit', handleUpload);
          authContainer.querySelector('#logout-btn').addEventListener('click', handleLogout);
          $('#auth-menu-text').textContent = 'Panel Admin';
        } else {
          // Tampilkan form login saja
          authContainer.innerHTML = `
              <div id="login-view">
                <h2>Login</h2>
                <form id="login-form">
                  <label for="email">Email:</label><input type="email" id="email" name="email" required>
                  <label for="password">Password:</label><input type="password" id="password" name="password" required>
                  <button type="submit">Login</button>
                </form>
              </div>`;
          authContainer.querySelector('#login-form').addEventListener('submit', handleLogin);
          $('#auth-menu-text').textContent = 'Login';
        }
      }

      async function handleLogin(e) {
        e.preventDefault();
        const email = e.target.email.value;
        const password = e.target.password.value;
        const { error } = await supabase.auth.signInWithPassword({ email, password });
        if (error) {
          alert("Login Gagal: " + error.message);
        } else {
          await setupAdminUI(); // Muat ulang konten modal
          closeAuthModal();   // Tutup modal setelah berhasil login
        }
      }

      async function handleLogout() {
        await supabase.auth.signOut();
        await setupAdminUI(); // Muat ulang konten modal menjadi form login
      }

      async function handleUpload(e) {
        e.preventDefault();
        const form = e.target;
        const postData = {
          title: form.title.value, description: form.description.value, category: form.category.value,
          isFeatured: form.isFeatured.checked, img: form.img.value,
          links: { mediafire: form.mediafire.value, gofile: form.gofile.value }
        };
        const { error } = await supabase.from('posts').insert([postData]);
        if (error) {
          alert('Upload Gagal: ' + error.message);
        } else {
          alert('Postingan berhasil diupload!');
          form.reset();
          closeAuthModal();
          fetchPosts();
        }
      }

      // --- INISIALISASI ---
      async function fetchPosts() {
        try {
          const { data, error } = await supabase.from('posts').select('*').order('created_at', { ascending: false });
          if (error) throw error;
          state.posts = data;
          renderPosts();
        } catch (error) {
            console.error('Gagal memuat data postingan:', error);
            $('#post-grid').innerHTML = `<p style="color: var(--muted); text-align: center;">Gagal memuat data. Silakan coba lagi nanti.</p>`;
        }
      }
      
      const init = async () => {
        const savedTheme = localStorage.getItem('luminox_theme') || '';
        if (savedTheme) {
            document.documentElement.dataset.theme = savedTheme;
            $('#theme-toggle i').className = savedTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        }
        const skeletonGrid = $('#skeleton-grid');
        const skeletonCardHTML = `<div class="skeleton-card"><div class="skeleton-img shimmer"></div><div class="skeleton-content"><div class="skeleton-line shimmer" style="width: 35%;"></div><div class="skeleton-line shimmer" style="width: 85%;"></div><div class="skeleton-line shimmer" style="width: 60%;"></div></div></div>`;
        skeletonGrid.innerHTML = Array(4).fill(skeletonCardHTML).join('');
        
        await fetchPosts();
        await setupAdminUI(); // Siapkan konten modal di latar belakang saat halaman dimuat
      };

      init();
    });
  </script>
</body>
</html>
